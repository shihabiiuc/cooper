---
import { Copy, Check } from 'lucide-react';

interface Props {
  text: string;
}

const { text } = Astro.props;
---

<button
  class="copy-button p-2 rounded-lg bg-foreground/5 hover:bg-foreground/10 text-foreground/50 hover:text-foreground transition-all border border-transparent hover:border-foreground/10 relative group"
  aria-label="Copy changelog content"
  title="Copy raw content"
  data-text={text}
>
  <div class="scale-100 opacity-100 transition-all duration-200 group-[.copied]:scale-80 group-[.copied]:opacity-0 absolute inset-0 flex items-center justify-center">
    <Copy className="w-4 h-4" />
  </div>
  <div class="scale-80 opacity-0 transition-all duration-200 group-[.copied]:scale-100 group-[.copied]:opacity-100 flex items-center justify-center">
    <Check className="w-4 h-4 text-emerald-500" />
  </div>
</button>

<script>
  function initCopyButtons() {
    const buttons = document.querySelectorAll('.copy-button');
    
    buttons.forEach(button => {
      button.addEventListener('click', async () => {
        const text = button.getAttribute('data-text');
        if (!text) return;

        try {
          await navigator.clipboard.writeText(text);
          button.classList.add('copied');
          setTimeout(() => {
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      });
    });
  }

  // Run on initial load
  initCopyButtons();

  // Run on view transitions navigation
  document.addEventListener('astro:page-load', initCopyButtons);
</script>
